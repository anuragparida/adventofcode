import copy

inp = """..#.....##......#............#..................................#.....#..............#................#.........................#.
..........................................................................................................#..........#...#.......#
..................#....................#.......................................#.....#....#............#.......#..................
......#...#..##....................................................................#...#.......#..........#..#.....#..............
..#..#.#.............#.#.........#.........##..................#..............#..........................#........................
#..........#.................#..........#...............................#..#.................#.......##..##..#.#..................
......................#......................................................#........................#......................#....
........................#.#.....................................#..............................#.......#.............#.....#......
#.................#...#......#..........#.......#.....#............................................#...........##.........#.....#.
...........................................#.....#............##...............#..............................#...................
.....#..............#......................................#..........#............#..................##...............#......###.
..............#..#.....................................##................#............................#............#......#.......
#........#...................................................#..........................................#.........................
.................................................................................#................................#....#..#..#....
.............................#.###.........#.#...............#..........................................##........................
......................................................................................................................#.........#.
...............#............#............#...#.........#............#.............................#.#........................#....
........................#...............#...............#........#.........#................#....#.#....................#.........
........#...............#...........................................................................................#.............
.................#..........................................................#.....................................................
........#.#.#...................#..#.......#...........#..#............#......#.....................#.....#.........#..#..........
..#.......#..................................................................................................#......#.............
................##...##......................#....................................................#..............................#
............#......................................#...........................#.#...#...............#.....................##.....
..........#...................#.....................#...........................................##................................
.#.......................#...............................................................#........................................
...................................................................#..#................#.....#....................#...............
...........#...........................................................#..........................................................
.....#....#..#..........................................................#..................#.....................##...............
...#................................#.....#...................#...............##...........#..............#.......................
.......##.....#.............#..#.......................................................................#......................#...
......................................#....#.............................................#...#....................#...............
.......#.......#...............#..#.....#..............................#.#......#...............#.................................
......................#.......#.......#..........................................................#................#...........#...
..............................#........................#.......#..#...............................#...............................
...........................#..........#..##.......................#................#..............................................
..............#............#...##........#.................................#................#....#........................#..#....
..............#.........#............................................#.............#......#......#.#....#.........................
.......................#.................................#..#..#..#..............................................#................
........................###..#...............................................................#.........#................#......#..
#........................................................................................#........................................
........................................#..............................##.....#.........................#...........#.............
.............#.........#...#................#..#..........#.....#...........................................................#.....
.......................................#......#.............................#.........#................#..........................
..........................................................#......................#...........#...#.......#........................
#.....................................#.#...#.............................................................#...........#........#..
............................#..................................................................................#............#.....
#.................#.................................................................#..............#...................#..........
........#...................................................................#...............................................#.....
.................#...#..................#.............................................................#.......#...................
...#.....#.................................................................................................#..........#...........
..........#...................................#....#................#......#........................................#.......#.....
.....................................#...............#................................................................#...........
.#............#................................................................#.............................................#....
...........#.........#.....................#...........#^.......................#.....................#..........#................
.....#........#.................................................................................................#.......#.........
..........#..........................#.......#......................#..............................#....#......................#..
...#.........................#.................#....#........#....................................................................
...............#...#........................................#................................#....#........................#.#....
...........#.......................................#......#....#.......................................................#.......#..
#.........#...............#..#..#..........#..............#...........................#...........#.....................#.........
...................#.......................................................#......................................................
.............#..............................................#.......................................#.........#...........#......#
....#......#...#.................................#.....#......#.................................#.................................
...............#...............#......................................................................#...........................
.......................#.........................................................................................................#
.............................#............................................................................#.......................
...................#..#.........#...........................#......#...............#......#.......................................
...#....................................#...................#..#...........................#............#...............#........#
...................#................................................................#............##...............................
........................#.#...................#.....................................................................#...#.........
...................#......#.......#.#......................................................#...............#......................
....#...........................#................#.............................#..#....................#........##.....#..........
.........................#......................................................#.#......................................#........
.........#.............#.................#........................................................................................
.#.#.......#..#....#.......#...#..#......................................................................#.#......................
..#.................#............................................................................#................................
.#................................#...............................................................................................
..........#............#..............................................#...#...............##...............#..................#...
................................#.........................#.......................................................................
........................................................##.......#........................#.....................#.................
......#......................................................#......#.........#........................................#.......#..
...........................................................#............#....#......#.............................................
..................................#...................................................#.................................#...#.....
.......#...#..........#............#.......#........................................#..#.................#........................
....................#........................................#........#...........................................................
.................................##..#............#.................................#.............#..................#....#.......
.#.................#..........#.....#...........#.......................................................#...................#.....
........................#.........................................................................................................
...#..........................................#...........................#.................................#.....................
............#......................................................#.................................#.........#..............#...
.............#........##.........#..................#...#.............#......#....##................#................#............
..................#...........................................................................................#.................#.
.....................#..#..#....................#........................#.........#................................#.............
..............................................#...................#............................#..............................#...
.......................#.#...................................#.............................#...................................#..
................................#...........#.............................#.............#.........#..............................#
...........................#................................#...................................................#.....#...........
..........#..........#.....#..........#..#............#..........#.................#.......#.......#........................#....#
...#.......#...#..............................................................................................#......#......#.....
...........#......................#..#.................#......#.........#.....#.............#............##................#....#.
.......#...........................................#..................#...............#.............................#.............
....#.......#.................................#..................................................................#................
..#..................................#...#............................#.........#....#..........#............................#....
....................................................#.................#...........................................#...............
............#......................................#.........#..................#.....#.#.#.#..#..................................
#..............#.......#...#.#..............#.....#.#.............................................................................
...........#.#.................................#...#........................................#................#.........#....#.....
......#.........................................#.........................#...........................................#...........
...#......#.................................#......#............................................................................#.
...#.................#....##................#...........................................#.........#....#..........................
...........#...#...#..................#...................................#......................................#......#.....#.#.
...................................#....................#................#..................................................#.....
................#.....................................#...........#......#........................................................
..............................#......#..#..............................................##........#......#......................#.#
#...........................#....#....##.....#...........................##..#...................#.....#........#.................
..........#....#.#..................#..........#..#................#.................#..................................##.......#
...................#.....................#......#...........................................................#..........#..........
........#.....#.............................#..............................................#......................................
......#............#.#.................................................................................................#..#.......
.#.........#..................................................................................#....#...........#.................#
........#.....#.......................#.........................................#...........................................#.....
...................#.......#..#......#.................##......................................#...................#..............
.............................#.................................#........#.......#..................................#.........#....
....#....#..........#....###..#...................................................#...#................................#.......#..
...................#...................................................#.......#....#........................#....................
...#................#...........#.......................#.....................................#...#......#......#.................
.......#........................#.........#.............................................................#...#...#.................
....................#.........#..............................#..........................#....................#..#.................
..#..........................#.#...................................#..................#..........#................#..............."""

# inp = """....#.....
# .........#
# ..........
# ..#.......
# .......#..
# ..........
# .#..^.....
# ........#.
# #.........
# ......#..."""

il = []
for line in inp.split("\n"):
    il.append(list(line))

# for line in il:
#     print('\"'+ "".join(line) +'\"')

# il = [[".", ".", "^"],[".", ".", "."]]

hl = len(il[0])
vl = len(il)

v, h = 0, 0
facing = 0

#0 up, 1 right, 2 down, 3 left

for i in range(vl):
    for j in range(hl):
        if il[i][j] == "^":
            v = i
            h = j
            il[i][j] = "X"
            break

globalv = v
globalh = h

faceil = [[[] for j in range(hl)] for i in range(vl)]
# print(v, h)
# print(faceil)
ocount = 0
ocountar = []

def checkdirectsightandfacing(v, h, facing):
    if facing == 0:
        while v >= 0 and v < vl and h >= 0 and h < hl:
            if il[v][h] == "#":
                return False
            elif il[v][h] == "X" and facing in faceil[v][h]:
                return True
            v -= 1
    elif facing == 1:
        while v >= 0 and v < vl and h >= 0 and h < hl:
            if il[v][h] == "#":
                return False
            elif il[v][h] == "X" and facing in faceil[v][h]:
                return True
            h += 1
    elif facing == 2:
        while v >= 0 and v < vl and h >= 0 and h < hl:
            if il[v][h] == "#":
                return False
            elif il[v][h] == "X" and facing in faceil[v][h]:
                return True
            v += 1
    elif facing == 3:
        while v >= 0 and v < vl and h >= 0 and h < hl:
            if il[v][h] == "#":
                return False
            elif il[v][h] == "X" and facing in faceil[v][h]:
                return True
            h -= 1
    return False

def isLoopAtPos(ov, oh):
    ilcopy = copy.deepcopy(il)
    faceilcopy = copy.deepcopy(faceil)
    ilcopy[ov][oh] = "#"
    facing = 0
    v = globalv
    h = globalh
    while v >= 0 and v < vl and h >= 0 and h < hl:
        # if checkdirectsightandfacing(v, h, (facing + 1) % 4):
        #     print("loop at ", ov, oh, " because sight")
        #     return True
        if ilcopy[v][h] =="X" and facing in faceilcopy[v][h]:
            # print("loop at ", ov, oh, " because on X facing same")
            return True
        if ilcopy[v][h] == "#":
            if facing == 0:
                v += 1 
            elif facing == 1:
                h -= 1
            elif facing == 2:
                v -= 1
            elif facing == 3:
                h += 1
            facing = (facing + 1) % 4
        else:
            ilcopy[v][h] = "X"
            faceilcopy[v][h].append(facing)
            if facing == 0:
                v -= 1 
            elif facing == 1:
                h += 1
            elif facing == 2:
                v += 1
            elif facing == 3:
                h -= 1
    return False
        # print("\n\n ilcopy:")
        # print('\n'.join(['\t'.join([str(cell) for cell in row]) for row in ilcopy]))
        # print("\n faceil:")
        # print('\n'.join(['\t'.join([str(cell) for cell in row]) for row in faceil]))
        # print("\n ocountar:")
        # print('\n'.join(['\t'.join([str(cell) for cell in row]) for row in ocountar]))

from lvl5b import lvl5bfn

oarraycop = lvl5bfn()
# print(vl, hl)
for ln in range(vl):
    for cn in range(hl):
        if oarraycop[ln][cn] != "O":
          if isLoopAtPos(ln, cn):
              # print("loop at ", ln, cn)
              ocount += 1
              ocountar.append([ln, cn])
        else:
            ocount += 1
            ocountar.append([ln, cn])
        print ((ln*hl + cn)/(vl*hl) , "%")

print(ocount)
oarraycop = copy.deepcopy(il)

for el in ocountar:
    oarraycop[el[0]][el[1]] = "O"
print('\n'.join(['\t'.join([str(cell) for cell in row]) for row in oarraycop]))

